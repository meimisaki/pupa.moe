'use strict';

var Syncher = require('../../syncher');

var inspectObject = require('../../inspectObject');
var extract = require('../../extract');

var struct = require('struct');

function patchUser(id, obj, callback) {
	var client = this;
	client.getUser('admin', function (err, user) {
		var password = obj.old_password && obj.new_password;
		err = err || inspectObject(obj, struct.user, {
			old_password: function (val, key) {
				return !password || val == user.password;
			}
		});
		if (err) return callback(err);
		obj = extract(obj, struct.user);
		if (password) obj.password = password;
		client.patchObject('user', id, obj, callback);
	});
}

module.exports = patchUser;
